<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      html, body, #map_canvas { height: 100%; margin: 0; padding: 0;}
    </style>
    <script type="text/javascript"
					src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDQ3cwQiqcbd__Bcn3tpgcF8vd-Y2OGjVY&sensor=false"> </script>
    
	<script type="text/javascript">

	var zip = '33401';
	var map;
	var google;
	var locations = [
		["1", "", "27.340055", "-80.354004", ""],
		["2", "", "28.195506", "-81.760254", ""],
		["3", "", "25.767740", "-80.354004", ""],
	];
	var markersArray = [];

	var pinColor = "1f6d9b";
	var pinImage = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|" + pinColor,
		new google.maps.Size(21, 34),
		new google.maps.Point(0, 0),
		new google.maps.Point(10, 34));

	function initialize() {
		if (zip == 0)
			return;
		var geocoder = new google.maps.Geocoder();
		var lat = '';
		var lng = '';

		var mapOptions = {
			zoom: 10,
			center: new google.maps.LatLng(lat, lng),
			mapTypeId: google.maps.MapTypeId.ROADMAP,
			panControl: false,
			mapTypeControl: false,
			scaleControl: false,
			streetViewControl: false,
			overviewMapControl: false,
			rotateControl: false
		};

		map = new google.maps.Map(document.getElementById('map_canvas'),
			mapOptions);

		geocoder.geocode({ 'address': zip }, function (results, status) {
			if (status == google.maps.GeocoderStatus.OK) {
				map.setCenter(results[0].geometry.location);
				marker = new google.maps.Marker({
					position: results[0].geometry.location,
					map: map,
					title: zip,
					icon: pinImage
				});

				google.maps.event.addListener(marker, 'mouseover', function() {
					return function() {
						infowindow.setContent(contentString);
						infowindow.open(map, this);
					}
				}());

				for (i = 0; i < locations.length; i++) {
					if (locations[i][2] != null || locations[i][2] != '') {
						var latLng = new google.maps.LatLng(locations[i][2], locations[i][3]);
						var marker = new google.maps.Marker({
							position: latLng,
							map: map,
						});
						markersArray.push(marker);

						google.maps.event.addListener(marker, 'click', function (content) {
							return function () {
								infowindow.setContent(content);//set the content
								infowindow.open(map, this);
							}
						}(locations[i][4]));

					}
				}

				var lat = results[0].geometry.location.lat();
				var lng = results[0].geometry.location.lng();
				var R = 6371; // radius of earth in km
				var distances = [];
				var closest = -1;
				for (i = 0; i < locations.length; i++) {
					var mlat = locations[i][2];
					var mlng = locations[i][3];
					var dLat = rad(mlat - lat);
					var dLong = rad(mlng - lng);
					var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
						Math.cos(rad(lat)) * Math.cos(rad(lat)) * Math.sin(dLong / 2) * Math.sin(dLong / 2);
					var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
					var d = R * c;
					distances[i] = d;
					if (closest == -1 || d < distances[closest]) {
						closest = i;
					}
				}
				if (closest > -1) {
					var latLng = new google.maps.LatLng(locations[closest][2], locations[closest][3]);
					map.panTo(latLng);
				}
			}

		});
	}

	google.maps.event.addDomListener(window, 'load', initialize);

	var infowindow = new google.maps.InfoWindow({
		content: ""
	});

	function rad(x) { return x * Math.PI / 180; }

	var contentString = '<h2>Zipcode Entered</h2>';
	</script>
  </head>
  <body>
	<div id="map_canvas"></div>
  </body>
</html>